# Fidoo Blog ç³»ç»Ÿä¼˜åŒ–ä¸é‡æ„å»ºè®®

## ğŸ“‹ ç›®å½•

1. [ç°çŠ¶åˆ†æ](#ç°çŠ¶åˆ†æ)
2. [æ¶æ„ä¼˜åŒ–å»ºè®®](#æ¶æ„ä¼˜åŒ–å»ºè®®)
3. [ä»£ç è´¨é‡æå‡](#ä»£ç è´¨é‡æå‡)
4. [æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ](#æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ)
5. [å®‰å…¨æ€§å¢å¼º](#å®‰å…¨æ€§å¢å¼º)
6. [å¯ç»´æŠ¤æ€§æå‡](#å¯ç»´æŠ¤æ€§æå‡)
7. [ç”¨æˆ·ä½“éªŒä¼˜åŒ–](#ç”¨æˆ·ä½“éªŒä¼˜åŒ–)
8. [å®æ–½è·¯çº¿å›¾](#å®æ–½è·¯çº¿å›¾)

---

## ç°çŠ¶åˆ†æ

### âœ… ç°æœ‰ä¼˜åŠ¿

1. **æŠ€æœ¯æ ˆç°ä»£åŒ–**
   - Next.js 14 (App Router) + NestJS 10
   - TypeScript å®Œæ•´ç±»å‹æ”¯æŒ
   - Formily + Ant Design 5 ç°ä»£åŒ– UI
   - React Query æ•°æ®ç®¡ç†

2. **æ¶æ„è®¾è®¡åˆç†**
   - å‰åç«¯åˆ†ç¦»
   - æ¨¡å—åŒ–è®¾è®¡
   - ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
   - RBAC æƒé™ç³»ç»Ÿ

3. **ä¼ä¸šçº§åŠŸèƒ½**
   - å®¡è®¡æ—¥å¿—
   - åˆ†å¸ƒå¼é”
   - é™æµä¿æŠ¤
   - ç¼“å­˜æœºåˆ¶
   - æ‰¹é‡å¤„ç†

### âš ï¸ å­˜åœ¨çš„é—®é¢˜

#### Admin ç«¯é—®é¢˜

1. **ä»£ç é‡å¤**
   - API å“åº”ç±»å‹ `PaginatedResponse` åœ¨æ¯ä¸ª API æ–‡ä»¶ä¸­é‡å¤å®šä¹‰
   - ç¼ºå°‘ç»Ÿä¸€çš„ç±»å‹å®šä¹‰å’Œå¤ç”¨æœºåˆ¶

2. **é”™è¯¯å¤„ç†ä¸å®Œå–„**
   - ç¼ºå°‘å…¨å±€é”™è¯¯è¾¹ç•Œ
   - é”™è¯¯æç¤ºä¸å¤Ÿå‹å¥½
   - ç½‘ç»œé”™è¯¯é‡è¯•æœºåˆ¶ä¸å®Œå–„

3. **æ€§èƒ½ä¼˜åŒ–ä¸è¶³**
   - ç¼ºå°‘ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
   - å›¾ç‰‡èµ„æºæœªä¼˜åŒ–
   - ç¼ºå°‘è¯·æ±‚å»é‡å’Œé˜²æŠ–

4. **ç”¨æˆ·ä½“éªŒé—®é¢˜**
   - åŠ è½½çŠ¶æ€åé¦ˆä¸å¤Ÿæ˜æ˜¾
   - ç¼ºå°‘éª¨æ¶å±
   - è¡¨å•éªŒè¯æç¤ºä¸å¤Ÿå‹å¥½

5. **ç±»å‹å®‰å…¨**
   - éƒ¨åˆ† API ä½¿ç”¨ `any` ç±»å‹
   - èœå•æ•°æ®ç»“æ„ç¼ºå°‘ç±»å‹å®šä¹‰

#### Service ç«¯é—®é¢˜

1. **æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–**
   - ç¼ºå°‘æŸ¥è¯¢æ€§èƒ½ç›‘æ§
   - N+1 æŸ¥è¯¢é—®é¢˜å¯èƒ½å­˜åœ¨
   - ç¼ºå°‘æ…¢æŸ¥è¯¢æ—¥å¿—

2. **ç¼“å­˜ç­–ç•¥**
   - ç¼“å­˜å¤±æ•ˆç­–ç•¥ä¸å¤Ÿç²¾ç»†
   - ç¼ºå°‘ç¼“å­˜é¢„çƒ­æœºåˆ¶
   - ç¼“å­˜é”®ç®¡ç†ä¸å¤Ÿç»Ÿä¸€

3. **API è®¾è®¡**
   - éƒ¨åˆ†æ¥å£ç¼ºå°‘ç‰ˆæœ¬æ§åˆ¶
   - å“åº”æ ¼å¼ä¸ç»Ÿä¸€ï¼ˆéƒ¨åˆ†ä½¿ç”¨ POST è¿›è¡Œæ›´æ–°/åˆ é™¤ï¼‰
   - ç¼ºå°‘ API æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ

4. **ç›‘æ§å’Œæ—¥å¿—**
   - ç¼ºå°‘ APM ç›‘æ§
   - æ—¥å¿—ç»“æ„åŒ–ä¸å¤Ÿå®Œå–„
   - ç¼ºå°‘é”™è¯¯è¿½è¸ªç³»ç»Ÿ

5. **æµ‹è¯•è¦†ç›–**
   - ç¼ºå°‘å•å…ƒæµ‹è¯•
   - ç¼ºå°‘é›†æˆæµ‹è¯•
   - ç¼ºå°‘ E2E æµ‹è¯•

---

## æ¶æ„ä¼˜åŒ–å»ºè®®

### 1. å¼•å…¥é¢†åŸŸé©±åŠ¨è®¾è®¡ (DDD)

**é—®é¢˜**: å½“å‰ä¸šåŠ¡é€»è¾‘åˆ†æ•£åœ¨ Service å±‚ï¼Œç¼ºå°‘é¢†åŸŸæ¨¡å‹æŠ½è±¡

**æ–¹æ¡ˆ**:

- å°†ä¸šåŠ¡é€»è¾‘ä» Service å±‚æå–åˆ° Domain å±‚
- ä½¿ç”¨ Repository æ¨¡å¼å°è£…æ•°æ®è®¿é—®
- å¼•å…¥ Domain Events å¤„ç†ä¸šåŠ¡äº‹ä»¶

**ç¤ºä¾‹ç»“æ„**:

```
service/src/modules/posts/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ post.domain.service.ts      # é¢†åŸŸæœåŠ¡
â”‚   â”œâ”€â”€ post.entity.ts              # é¢†åŸŸå®ä½“
â”‚   â””â”€â”€ events/                     # é¢†åŸŸäº‹ä»¶
â”œâ”€â”€ repositories/
â”‚   â””â”€â”€ post.repository.ts          # ä»“å‚¨æ¥å£
â”œâ”€â”€ dto/
â””â”€â”€ posts.controller.ts
```

**å®æ–½ä¼˜å…ˆçº§**: é«˜

### 2. API ç½‘å…³æ¨¡å¼

**é—®é¢˜**: ç›´æ¥æš´éœ²æ‰€æœ‰æœåŠ¡æ¥å£ï¼Œç¼ºå°‘ç»Ÿä¸€å…¥å£

**æ–¹æ¡ˆ**:

- å¼•å…¥ API Gateway å±‚ï¼ˆå¯ä½¿ç”¨ NestJS çš„ Gateway æ¨¡å¼ï¼‰
- ç»Ÿä¸€å¤„ç†è®¤è¯ã€é™æµã€æ—¥å¿—
- æ”¯æŒ API ç‰ˆæœ¬ç®¡ç†

**å®æ–½ä¼˜å…ˆçº§**: ä¸­

### 3. å¾®æœåŠ¡åŒ–å‡†å¤‡

**é—®é¢˜**: å•ä½“åº”ç”¨ï¼Œæ‰©å±•æ€§å—é™

**æ–¹æ¡ˆ**:

- æŒ‰ä¸šåŠ¡åŸŸæ‹†åˆ†æ¨¡å—ï¼ˆå†…å®¹ã€ç”¨æˆ·ã€ç³»ç»Ÿï¼‰
- ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦æœåŠ¡
- ä¸ºæœªæ¥å¾®æœåŠ¡åŒ–åšå‡†å¤‡

**å®æ–½ä¼˜å…ˆçº§**: ä½ï¼ˆé•¿æœŸè§„åˆ’ï¼‰

---

## ä»£ç è´¨é‡æå‡

### 1. ç±»å‹ç³»ç»Ÿå®Œå–„

#### Admin ç«¯

**é—®é¢˜**: API å“åº”ç±»å‹é‡å¤å®šä¹‰ï¼Œèœå•ç±»å‹ä½¿ç”¨ `any`

**æ–¹æ¡ˆ**:

```typescript
// admin/src/lib/api/types.ts
export interface PaginatedResponse<T> {
  items: T[];
  total: number;
  page: number;
  pageSize: number;
  totalPages: number;
}

// admin/src/types/menu.ts
export interface MenuItem {
  id: string;
  title: string;
  name: string;
  path?: string;
  icon?: string;
  status: 'enabled' | 'disabled';
  isHidden: boolean;
  children?: MenuItem[];
  permission?: string;
  sortOrder: number;
}
```

**å®æ–½æ­¥éª¤**:

1. åˆ›å»ºç»Ÿä¸€çš„ç±»å‹å®šä¹‰æ–‡ä»¶
2. é‡æ„æ‰€æœ‰ API æ–‡ä»¶ä½¿ç”¨ç»Ÿä¸€ç±»å‹
3. ä¸ºèœå•ç³»ç»Ÿæ·»åŠ å®Œæ•´ç±»å‹å®šä¹‰

**å®æ–½ä¼˜å…ˆçº§**: é«˜

#### Service ç«¯

**é—®é¢˜**: éƒ¨åˆ† DTO éªŒè¯ä¸å¤Ÿä¸¥æ ¼

**æ–¹æ¡ˆ**:

- ä½¿ç”¨ `class-validator` è£…é¥°å™¨å¢å¼ºéªŒè¯
- æ·»åŠ è‡ªå®šä¹‰éªŒè¯å™¨
- ç»Ÿä¸€é”™è¯¯æ¶ˆæ¯æ ¼å¼

### 2. é”™è¯¯å¤„ç†ä¼˜åŒ–

#### Admin ç«¯

**é—®é¢˜**: ç¼ºå°‘å…¨å±€é”™è¯¯è¾¹ç•Œå’Œç»Ÿä¸€é”™è¯¯å¤„ç†

**æ–¹æ¡ˆ**:

```typescript
// admin/src/components/error/ErrorBoundary.tsx
'use client';

import React from 'react';
import { Result, Button } from 'antd';

interface ErrorBoundaryState {
  hasError: boolean;
  error?: Error;
}

export class ErrorBoundary extends React.Component<
  { children: React.ReactNode },
  ErrorBoundaryState
> {
  constructor(props: { children: React.ReactNode }) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error) {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error('Error caught by boundary:', error, errorInfo);
    // å¯ä»¥å‘é€é”™è¯¯åˆ°ç›‘æ§ç³»ç»Ÿ
  }

  render() {
    if (this.state.hasError) {
      return (
        <Result
          status="500"
          title="500"
          subTitle="æŠ±æ­‰ï¼Œé¡µé¢å‡ºç°äº†é”™è¯¯"
          extra={
            <Button type="primary" onClick={() => window.location.reload()}>
              åˆ·æ–°é¡µé¢
            </Button>
          }
        />
      );
    }

    return this.props.children;
  }
}
```

**å®æ–½ä¼˜å…ˆçº§**: é«˜

#### Service ç«¯

**é—®é¢˜**: é”™è¯¯ä¿¡æ¯ä¸å¤Ÿè¯¦ç»†ï¼Œç¼ºå°‘é”™è¯¯ç è§„èŒƒ

**æ–¹æ¡ˆ**:

- å»ºç«‹é”™è¯¯ç è§„èŒƒæ–‡æ¡£
- ä¸ºå¸¸è§é”™è¯¯æ·»åŠ è¯¦ç»†è¯´æ˜
- åŒºåˆ†ä¸šåŠ¡é”™è¯¯å’Œç³»ç»Ÿé”™è¯¯

### 3. ä»£ç å¤ç”¨ä¼˜åŒ–

#### Admin ç«¯

**é—®é¢˜**: è¡¨æ ¼ã€è¡¨å•ç»„ä»¶ä½¿ç”¨æ¨¡å¼é‡å¤

**æ–¹æ¡ˆ**:

- åˆ›å»ºé«˜é˜¶ç»„ä»¶ (HOC) å°è£…é€šç”¨é€»è¾‘
- ä½¿ç”¨ Render Props æ¨¡å¼æé«˜çµæ´»æ€§
- æå–å…¬å…±ä¸šåŠ¡é€»è¾‘åˆ°è‡ªå®šä¹‰ Hooks

**ç¤ºä¾‹**:

```typescript
// admin/src/components/crud/CrudPage.tsx
interface CrudPageProps<T> {
  title: string;
  api: CrudApi<T>;
  columns: ColumnType<T>[];
  formFields: FormFieldConfig[];
  permissions?: {
    create?: string;
    update?: string;
    delete?: string;
  };
}

export function CrudPage<T>(props: CrudPageProps<T>) {
  // ç»Ÿä¸€çš„ CRUD é¡µé¢å®ç°
}
```

**å®æ–½ä¼˜å…ˆçº§**: ä¸­

---

## æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

### 1. å‰ç«¯æ€§èƒ½ä¼˜åŒ–

#### ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½

**æ–¹æ¡ˆ**:

```typescript
// admin/src/app/(admin)/posts/page.tsx
import dynamic from 'next/dynamic';

const PostsTable = dynamic(() => import('@/components/post/PostsTable'), {
  loading: () => <Skeleton active />,
  ssr: false,
});
```

#### å›¾ç‰‡ä¼˜åŒ–

**æ–¹æ¡ˆ**:

- ä½¿ç”¨ Next.js Image ç»„ä»¶
- å®ç°å›¾ç‰‡æ‡’åŠ è½½
- ä½¿ç”¨ WebP æ ¼å¼

#### è¯·æ±‚ä¼˜åŒ–

**æ–¹æ¡ˆ**:

- å®ç°è¯·æ±‚å»é‡ï¼ˆReact Query å·²æ”¯æŒï¼‰
- æ·»åŠ è¯·æ±‚é˜²æŠ–
- ä½¿ç”¨ä¹è§‚æ›´æ–°

```typescript
// admin/src/hooks/useOptimisticUpdate.ts
export function useOptimisticUpdate<T>(queryKey: string[], updateFn: (old: T) => T) {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: async (data: T) => {
      // ä¹è§‚æ›´æ–°
      queryClient.setQueryData(queryKey, updateFn);
      // å®é™…æ›´æ–°
      return await api.update(data);
    },
    onError: () => {
      // å›æ»š
      queryClient.invalidateQueries({ queryKey });
    },
  });
}
```

**å®æ–½ä¼˜å…ˆçº§**: é«˜

### 2. åç«¯æ€§èƒ½ä¼˜åŒ–

#### æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

**é—®é¢˜**: å¯èƒ½å­˜åœ¨ N+1 æŸ¥è¯¢é—®é¢˜

**æ–¹æ¡ˆ**:

- ä½¿ç”¨ TypeORM çš„ `relations` é¢„åŠ è½½å…³è”æ•°æ®
- å®ç°æŸ¥è¯¢æ€§èƒ½ç›‘æ§
- æ·»åŠ æ…¢æŸ¥è¯¢æ—¥å¿—

```typescript
// service/src/common/decorators/query-performance.decorator.ts
export function QueryPerformance() {
  return function (target: any, propertyKey: string, descriptor: PropertyDescriptor) {
    const originalMethod = descriptor.value;
    descriptor.value = async function (...args: any[]) {
      const start = Date.now();
      const result = await originalMethod.apply(this, args);
      const duration = Date.now() - start;

      if (duration > 1000) {
        this.logger.warn(`Slow query detected: ${propertyKey} took ${duration}ms`);
      }

      return result;
    };
  };
}
```

#### ç¼“å­˜ç­–ç•¥ä¼˜åŒ–

**é—®é¢˜**: ç¼“å­˜å¤±æ•ˆç­–ç•¥ä¸å¤Ÿç²¾ç»†

**æ–¹æ¡ˆ**:

- å®ç°ç¼“å­˜æ ‡ç­¾ç³»ç»Ÿ
- ä½¿ç”¨ç¼“å­˜é¢„çƒ­
- å®ç°å¤šçº§ç¼“å­˜

```typescript
// service/src/common/cache/cache-tags.service.ts
@Injectable()
export class CacheTagsService {
  async invalidateByTag(tag: string) {
    const keys = await this.redis.keys(`*:tag:${tag}:*`);
    if (keys.length > 0) {
      await this.redis.del(...keys);
    }
  }
}
```

**å®æ–½ä¼˜å…ˆçº§**: é«˜

#### API å“åº”ä¼˜åŒ–

**æ–¹æ¡ˆ**:

- å®ç°å­—æ®µé€‰æ‹©ï¼ˆGraphQL-likeï¼‰
- æ·»åŠ å“åº”å‹ç¼©
- ä½¿ç”¨ ETag ç¼“å­˜

```typescript
// service/src/common/decorators/select-fields.decorator.ts
export function SelectFields() {
  return function (target: any, propertyKey: string, descriptor: PropertyDescriptor) {
    // æ ¹æ®æŸ¥è¯¢å‚æ•°é€‰æ‹©è¿”å›å­—æ®µ
  };
}
```

**å®æ–½ä¼˜å…ˆçº§**: ä¸­

---

## å®‰å…¨æ€§å¢å¼º

### 1. è¾“å…¥éªŒè¯å¼ºåŒ–

**æ–¹æ¡ˆ**:

- ä½¿ç”¨ `class-validator` è¿›è¡Œä¸¥æ ¼éªŒè¯
- å®ç° XSS é˜²æŠ¤
- æ·»åŠ  SQL æ³¨å…¥é˜²æŠ¤ï¼ˆTypeORM å·²æä¾›ï¼‰

```typescript
// service/src/common/pipes/sanitize.pipe.ts
@Injectable()
export class SanitizePipe implements PipeTransform {
  transform(value: any) {
    // æ¸…ç† HTML æ ‡ç­¾
    // è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
    return sanitizedValue;
  }
}
```

### 2. è®¤è¯å’Œæˆæƒä¼˜åŒ–

**é—®é¢˜**: Token åˆ·æ–°æœºåˆ¶å¯ä»¥ä¼˜åŒ–

**æ–¹æ¡ˆ**:

- å®ç° Token é»‘åå•æœºåˆ¶
- æ·»åŠ è®¾å¤‡ç®¡ç†
- å®ç°å•ç‚¹ç™»å½• (SSO)

```typescript
// service/src/modules/auth/services/token-blacklist.service.ts
@Injectable()
export class TokenBlacklistService {
  async addToBlacklist(token: string, expiresIn: number) {
    await this.redis.set(`blacklist:${token}`, '1', 'EX', expiresIn);
  }

  async isBlacklisted(token: string): Promise<boolean> {
    return (await this.redis.get(`blacklist:${token}`)) === '1';
  }
}
```

**å®æ–½ä¼˜å…ˆçº§**: é«˜

### 3. å®‰å…¨å®¡è®¡

**æ–¹æ¡ˆ**:

- è®°å½•æ‰€æœ‰æ•æ„Ÿæ“ä½œ
- å®ç°å¼‚å¸¸ç™»å½•æ£€æµ‹
- æ·»åŠ æ“ä½œæ—¥å¿—æŸ¥è¯¢æ¥å£

**å®æ–½ä¼˜å…ˆçº§**: ä¸­

---

## å¯ç»´æŠ¤æ€§æå‡

### 1. æµ‹è¯•è¦†ç›–

**é—®é¢˜**: ç¼ºå°‘æµ‹è¯•

**æ–¹æ¡ˆ**:

#### å•å…ƒæµ‹è¯•

```typescript
// service/src/modules/users/users.service.spec.ts
describe('UsersService', () => {
  let service: UsersService;
  let repository: Repository<User>;

  beforeEach(async () => {
    const module = await Test.createTestingModule({
      providers: [
        UsersService,
        {
          provide: getRepositoryToken(User),
          useValue: mockRepository,
        },
      ],
    }).compile();

    service = module.get<UsersService>(UsersService);
    repository = module.get<Repository<User>>(getRepositoryToken(User));
  });

  it('should create a user', async () => {
    const createDto = { username: 'test', email: 'test@example.com' };
    const user = await service.create(createDto);
    expect(user.username).toBe('test');
  });
});
```

#### é›†æˆæµ‹è¯•

```typescript
// service/test/users.e2e-spec.ts
describe('Users (e2e)', () => {
  let app: INestApplication;

  beforeAll(async () => {
    const moduleFixture = await Test.createTestingModule({
      imports: [AppModule],
    }).compile();

    app = moduleFixture.createNestApplication();
    await app.init();
  });

  it('/users (POST)', () => {
    return request(app.getHttpServer())
      .post('/api/v1/users')
      .send({ username: 'test', email: 'test@example.com' })
      .expect(201);
  });
});
```

**å®æ–½ä¼˜å…ˆçº§**: é«˜

### 2. æ–‡æ¡£å®Œå–„

**æ–¹æ¡ˆ**:

- ä½¿ç”¨ Swagger/OpenAPI è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£
- å®Œå–„ä»£ç æ³¨é‡Š
- åˆ›å»ºå¼€å‘æŒ‡å—æ–‡æ¡£

```typescript
// service/src/modules/users/users.controller.ts
@ApiTags('ç”¨æˆ·ç®¡ç†')
@Controller('users')
export class UsersController {
  @Post()
  @ApiOperation({ summary: 'åˆ›å»ºç”¨æˆ·' })
  @ApiResponse({ status: 201, description: 'ç”¨æˆ·åˆ›å»ºæˆåŠŸ' })
  @ApiResponse({ status: 400, description: 'å‚æ•°é”™è¯¯' })
  create(@Body() createUserDto: CreateUserDto) {
    // ...
  }
}
```

**å®æ–½ä¼˜å…ˆçº§**: ä¸­

### 3. ä»£ç è§„èŒƒ

**æ–¹æ¡ˆ**:

- ä½¿ç”¨ ESLint + Prettier
- é…ç½® Pre-commit Hooks
- ä½¿ç”¨ Husky + lint-staged

```json
// .husky/pre-commit
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npx lint-staged
```

**å®æ–½ä¼˜å…ˆçº§**: é«˜

---

## ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### 1. åŠ è½½çŠ¶æ€ä¼˜åŒ–

**æ–¹æ¡ˆ**:

- ä½¿ç”¨éª¨æ¶å±æ›¿ä»£ Loading
- å®ç°æ¸è¿›å¼åŠ è½½
- æ·»åŠ åŠ è½½è¿›åº¦æ¡

```typescript
// admin/src/components/skeleton/TableSkeleton.tsx
export function TableSkeleton({ columns = 5, rows = 5 }) {
  return (
    <Table
      columns={Array.from({ length: columns }).map(() => ({
        title: <Skeleton.Input active />,
        dataIndex: 'loading',
      }))}
      dataSource={Array.from({ length: rows })}
      pagination={false}
    />
  );
}
```

**å®æ–½ä¼˜å…ˆçº§**: ä¸­

### 2. é”™è¯¯æç¤ºä¼˜åŒ–

**æ–¹æ¡ˆ**:

- ä½¿ç”¨å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- æä¾›é”™è¯¯æ¢å¤å»ºè®®
- å®ç°é”™è¯¯é‡è¯•æœºåˆ¶

```typescript
// admin/src/components/error/ErrorAlert.tsx
export function ErrorAlert({ error, onRetry }: ErrorAlertProps) {
  const errorMessage = getErrorMessage(error);

  return (
    <Alert
      message="æ“ä½œå¤±è´¥"
      description={errorMessage}
      type="error"
      action={
        <Button size="small" onClick={onRetry}>
          é‡è¯•
        </Button>
      }
    />
  );
}
```

**å®æ–½ä¼˜å…ˆçº§**: ä¸­

### 3. è¡¨å•ä½“éªŒä¼˜åŒ–

**æ–¹æ¡ˆ**:

- å®æ—¶éªŒè¯åé¦ˆ
- è‡ªåŠ¨ä¿å­˜è‰ç¨¿
- æ™ºèƒ½æç¤º

**å®æ–½ä¼˜å…ˆçº§**: ä½

---

## å®æ–½è·¯çº¿å›¾

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€ä¼˜åŒ–ï¼ˆ1-2 å‘¨ï¼‰

**ç›®æ ‡**: è§£å†³æœ€ç´§è¿«çš„é—®é¢˜ï¼Œæå‡ä»£ç è´¨é‡

1. âœ… **ç±»å‹ç³»ç»Ÿå®Œå–„**
   - ç»Ÿä¸€ API å“åº”ç±»å‹
   - å®Œå–„èœå•ç±»å‹å®šä¹‰
   - æ¶ˆé™¤ `any` ç±»å‹

2. âœ… **é”™è¯¯å¤„ç†ä¼˜åŒ–**
   - æ·»åŠ å…¨å±€é”™è¯¯è¾¹ç•Œ
   - ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶
   - ä¼˜åŒ–é”™è¯¯æç¤º

3. âœ… **ä»£ç è§„èŒƒ**
   - é…ç½® ESLint + Prettier
   - è®¾ç½® Pre-commit Hooks
   - ä¿®å¤ç°æœ‰ä»£ç è§„èŒƒé—®é¢˜

**é¢„æœŸæ”¶ç›Š**:

- ä»£ç å¯ç»´æŠ¤æ€§æå‡ 30%
- Bug å‡å°‘ 20%

### ç¬¬äºŒé˜¶æ®µï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆ2-3 å‘¨ï¼‰

**ç›®æ ‡**: æå‡ç³»ç»Ÿæ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ

1. âœ… **å‰ç«¯æ€§èƒ½ä¼˜åŒ–**
   - ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
   - å›¾ç‰‡ä¼˜åŒ–
   - è¯·æ±‚ä¼˜åŒ–

2. âœ… **åç«¯æ€§èƒ½ä¼˜åŒ–**
   - æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
   - ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
   - API å“åº”ä¼˜åŒ–

3. âœ… **ç›‘æ§å’Œæ—¥å¿—**
   - æ·»åŠ æ€§èƒ½ç›‘æ§
   - å®Œå–„æ—¥å¿—ç³»ç»Ÿ
   - å®ç°æ…¢æŸ¥è¯¢æ—¥å¿—

**é¢„æœŸæ”¶ç›Š**:

- é¡µé¢åŠ è½½é€Ÿåº¦æå‡ 40%
- API å“åº”æ—¶é—´å‡å°‘ 30%

### ç¬¬ä¸‰é˜¶æ®µï¼šå®‰å…¨æ€§å¢å¼ºï¼ˆ1-2 å‘¨ï¼‰

**ç›®æ ‡**: æå‡ç³»ç»Ÿå®‰å…¨æ€§

1. âœ… **è¾“å…¥éªŒè¯å¼ºåŒ–**
   - XSS é˜²æŠ¤
   - SQL æ³¨å…¥é˜²æŠ¤

2. âœ… **è®¤è¯æˆæƒä¼˜åŒ–**
   - Token é»‘åå•
   - è®¾å¤‡ç®¡ç†
   - å¼‚å¸¸ç™»å½•æ£€æµ‹

3. âœ… **å®‰å…¨å®¡è®¡**
   - æ“ä½œæ—¥å¿—å®Œå–„
   - å®‰å…¨äº‹ä»¶è®°å½•

**é¢„æœŸæ”¶ç›Š**:

- å®‰å…¨æ¼æ´å‡å°‘ 50%
- å®‰å…¨äº‹ä»¶å¯è¿½æº¯æ€§ 100%

### ç¬¬å››é˜¶æ®µï¼šæµ‹è¯•å’Œæ–‡æ¡£ï¼ˆ2-3 å‘¨ï¼‰

**ç›®æ ‡**: æå‡ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§

1. âœ… **æµ‹è¯•è¦†ç›–**
   - å•å…ƒæµ‹è¯•ï¼ˆç›®æ ‡è¦†ç›–ç‡ 70%ï¼‰
   - é›†æˆæµ‹è¯•
   - E2E æµ‹è¯•

2. âœ… **æ–‡æ¡£å®Œå–„**
   - API æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ
   - å¼€å‘æŒ‡å—
   - æ¶æ„æ–‡æ¡£

**é¢„æœŸæ”¶ç›Š**:

- ä»£ç è´¨é‡æå‡ 50%
- æ–°æˆå‘˜ä¸Šæ‰‹æ—¶é—´å‡å°‘ 40%

### ç¬¬äº”é˜¶æ®µï¼šæ¶æ„ä¼˜åŒ–ï¼ˆ3-4 å‘¨ï¼‰

**ç›®æ ‡**: ä¸ºæœªæ¥æ‰©å±•åšå‡†å¤‡

1. âœ… **DDD é‡æ„**
   - é¢†åŸŸæ¨¡å‹æå–
   - Repository æ¨¡å¼
   - Domain Events

2. âœ… **API ç½‘å…³**
   - ç»Ÿä¸€å…¥å£
   - ç‰ˆæœ¬ç®¡ç†
   - é™æµå’Œæ—¥å¿—

3. âœ… **å¾®æœåŠ¡å‡†å¤‡**
   - æ¨¡å—æ‹†åˆ†
   - æ¶ˆæ¯é˜Ÿåˆ—
   - æœåŠ¡å‘ç°

**é¢„æœŸæ”¶ç›Š**:

- ç³»ç»Ÿæ‰©å±•æ€§æå‡ 100%
- æ–°åŠŸèƒ½å¼€å‘æ•ˆç‡æå‡ 30%

---

## å…·ä½“å®æ–½æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: ç±»å‹ç³»ç»Ÿç»Ÿä¸€

**æ–‡ä»¶**: `admin/src/lib/api/types.ts`

```typescript
// ç»Ÿä¸€çš„ API å“åº”ç±»å‹
export interface PaginatedResponse<T> {
  items: T[];
  total: number;
  page: number;
  pageSize: number;
  totalPages: number;
}

export interface ApiResponse<T> {
  code: number;
  message: string;
  data: T;
  timestamp?: string;
}
```

**é‡æ„æ­¥éª¤**:

1. åˆ›å»ºç»Ÿä¸€ç±»å‹æ–‡ä»¶
2. æ›´æ–°æ‰€æœ‰ API æ–‡ä»¶å¯¼å…¥
3. åˆ é™¤é‡å¤ç±»å‹å®šä¹‰

### æ–¹æ¡ˆ 2: é”™è¯¯è¾¹ç•Œå®ç°

**æ–‡ä»¶**: `admin/src/components/error/ErrorBoundary.tsx`

ï¼ˆä»£ç è§ä¸Šæ–¹ç¤ºä¾‹ï¼‰

**é›†æˆæ­¥éª¤**:

1. åœ¨ `layout.tsx` ä¸­åŒ…è£¹åº”ç”¨
2. æ·»åŠ é”™è¯¯ä¸ŠæŠ¥
3. æ·»åŠ é”™è¯¯æ¢å¤æœºåˆ¶

### æ–¹æ¡ˆ 3: ç¼“å­˜ç­–ç•¥ä¼˜åŒ–

**æ–‡ä»¶**: `service/src/common/cache/cache-tags.service.ts`

ï¼ˆä»£ç è§ä¸Šæ–¹ç¤ºä¾‹ï¼‰

**å®æ–½æ­¥éª¤**:

1. å®ç°ç¼“å­˜æ ‡ç­¾æœåŠ¡
2. æ›´æ–° BaseService ä½¿ç”¨æ ‡ç­¾
3. å®ç°æ ‡ç­¾å¤±æ•ˆæœºåˆ¶

### æ–¹æ¡ˆ 4: æµ‹è¯•æ¡†æ¶æ­å»º

**æ–‡ä»¶**: `service/jest.config.js`

```javascript
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  coverageDirectory: 'coverage',
  collectCoverageFrom: ['src/**/*.ts', '!src/**/*.spec.ts', '!src/main.ts'],
  coverageThreshold: {
    global: {
      branches: 70,
      functions: 70,
      lines: 70,
      statements: 70,
    },
  },
};
```

---

## æ€»ç»“

### å…³é”®ä¼˜åŒ–ç‚¹

1. **ç±»å‹ç³»ç»Ÿ**: ç»Ÿä¸€ç±»å‹å®šä¹‰ï¼Œæå‡ç±»å‹å®‰å…¨
2. **é”™è¯¯å¤„ç†**: å…¨å±€é”™è¯¯è¾¹ç•Œï¼Œå‹å¥½é”™è¯¯æç¤º
3. **æ€§èƒ½ä¼˜åŒ–**: ä»£ç åˆ†å‰²ã€ç¼“å­˜ä¼˜åŒ–ã€æŸ¥è¯¢ä¼˜åŒ–
4. **å®‰å…¨æ€§**: è¾“å…¥éªŒè¯ã€Token ç®¡ç†ã€å®‰å…¨å®¡è®¡
5. **æµ‹è¯•è¦†ç›–**: å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€E2E æµ‹è¯•
6. **æ–‡æ¡£å®Œå–„**: API æ–‡æ¡£ã€å¼€å‘æŒ‡å—ã€æ¶æ„æ–‡æ¡£

### é¢„æœŸæ”¶ç›Š

- **ä»£ç è´¨é‡**: æå‡ 50%
- **æ€§èƒ½**: é¡µé¢åŠ è½½é€Ÿåº¦æå‡ 40%ï¼ŒAPI å“åº”æ—¶é—´å‡å°‘ 30%
- **å®‰å…¨æ€§**: å®‰å…¨æ¼æ´å‡å°‘ 50%
- **å¯ç»´æŠ¤æ€§**: æ–°åŠŸèƒ½å¼€å‘æ•ˆç‡æå‡ 30%
- **ç”¨æˆ·ä½“éªŒ**: é”™è¯¯å¤„ç†æ›´å‹å¥½ï¼ŒåŠ è½½ä½“éªŒæ›´æµç•…

### å®æ–½å»ºè®®

1. **ä¼˜å…ˆçº§æ’åº**: æŒ‰ç…§è·¯çº¿å›¾åˆ†é˜¶æ®µå®æ–½
2. **å°æ­¥å¿«è·‘**: æ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡ŒéªŒè¯
3. **æŒç»­æ”¹è¿›**: å»ºç«‹ä»£ç å®¡æŸ¥æœºåˆ¶
4. **å›¢é˜Ÿåä½œ**: æ˜ç¡®åˆ†å·¥ï¼Œå®šæœŸåŒæ­¥è¿›åº¦

---

## å‚è€ƒèµ„æº

- [NestJS æœ€ä½³å®è·µ](https://docs.nestjs.com/)
- [Next.js æ€§èƒ½ä¼˜åŒ–](https://nextjs.org/docs/app/building-your-application/optimizing)
- [TypeScript é«˜çº§ç±»å‹](https://www.typescriptlang.org/docs/handbook/2/types-from-types.html)
- [ä¼ä¸šçº§åº”ç”¨æ¶æ„æ¨¡å¼](https://martinfowler.com/books/eaa.html)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024-01-01  
**ç»´æŠ¤è€…**: Fidoo Blog Team
